# pnpm Configuration - Optimized for Enterprise Monorepo
# See: https://pnpm.io/npmrc

# ── Performance ──────────────────────────────────────────
# Use workspace protocol for internal dependencies
link-workspace-packages=true

# Enable hoisting for better deduplication
shamefully-hoist=false
hoist=true
hoist-pattern[]=*eslint*
hoist-pattern[]=*prettier*

# Parallel installation for faster CI/CD
prefer-frozen-lockfile=true
package-import-method=auto

# Network optimization
network-concurrency=16
fetch-retries=3
fetch-retry-factor=10
fetch-retry-mintimeout=10000
fetch-retry-maxtimeout=60000

# ── Strict Mode ──────────────────────────────────────────
# Prevent accidental package.json modifications
save-exact=false
save-prefix=~

# Auto-install peers (reduces manual work)
auto-install-peers=true
strict-peer-dependencies=false

# ── Logging ──────────────────────────────────────────────
loglevel=warn
progress=true

# ── Store Configuration ──────────────────────────────────
# Use symlinks for faster installs
symlink=true
enable-modules-dir=true

# Shared store location (default: ~/.pnpm-store)
# store-dir=~/.pnpm-store

# ── Lockfile ─────────────────────────────────────────────
# Lockfile format
lockfile=true
# Use Git-friendly lockfile format
git-checks=true

# ── Node Modules ─────────────────────────────────────────
# node-linker=isolated
modules-cache-max-age=10080

# ── Resolution ───────────────────────────────────────────
# Resolution mode
resolution-mode=highest

# ── Registry (optional - uncomment if using private registry) ───
# registry=https://registry.npmjs.org/
# @afenda:registry=https://npm.pkg.github.com/

# ── Scripts ──────────────────────────────────────────────
# Enable recursive scripts
enable-pre-post-scripts=true
recursive-install=true

# ── Workspaces ───────────────────────────────────────────
# Workspace-specific settings
workspace-concurrency=4

# ── Catalog Enforcement ──────────────────────────────────
# Strict mode: Fail if dependency not in catalog
# This prevents adding dependencies without catalog versions
catalog-mode=strict

# Clean up unused catalog entries on install
cleanup-unused-catalogs=true
