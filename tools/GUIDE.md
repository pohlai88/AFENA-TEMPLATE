# Tools Directory Guide

> **Auto-generated documentation** - Run `pnpm afena docs` to regenerate

## Architecture Principles

### Flat, Feature-Based Structure

The tools directory uses a **flat, feature-based organization**:

- **Max 2 levels deep** - Easy navigation
- **Clear purpose** - Each folder has one job
- **No unnecessary nesting** - Avoid `utils/helpers/common/`
- **Feature modules** - Group by what it does, not what it is

### Directory Naming

| Directory | Purpose | Examples |
|-----------|---------|----------|
| `core/` | Shared utilities | logger, paths, exec |
| `readme/` | README generation | analyzer, templates, renderer |
| `capability/` | Capability system | collectors, emitters, checks |
| `checks/` | Invariant checks | E1-E7, H00-H02 |
| `bundle/` | Bundle command | orchestration |
| `discovery/` | Package discovery | scan, register |
| `docs/` | Documentation | auto-generation |

## Report System

### Constants-Based Configuration

All reports are defined in `core/report-config.ts`:

```typescript
export const REPORT_CONFIGS = {
  bundle: {
    command: 'bundle',
    displayName: 'Bundle',
    tasks: [
      { key: 'readme', title: 'README Generation', icon: 'ðŸ“' },
      { key: 'meta', title: 'Metadata Checks', icon: 'ðŸ”' },
      { key: 'housekeeping', title: 'Housekeeping', icon: 'ðŸ§¹' },
    ],
  },
  // ... other commands
};
```

### Automatic Report Generation

Use `ReportBuilder` for automatic reports:

```typescript
const reportBuilder = new ReportBuilder('bundle', { dryRun });

// Add tasks - builder handles everything else
reportBuilder.addTask('readme', {
  success: true,
  message: 'Generated 5 READMEs',
  count: 5,
});

// Auto-generates CLI + optional Markdown
reportBuilder.generate();
```

## Adding New Commands

### 1. Add Report Configuration

Update `core/report-config.ts`:

```typescript
export const REPORT_CONFIGS = {
  // ... existing configs
  mycommand: {
    command: 'mycommand',
    displayName: 'My Command',
    description: 'Does something useful',
    tasks: [
      { key: 'task1', title: 'Task 1', icon: 'âœ“', description: '...' },
    ],
  },
};
```

### 2. Create Command Implementation

Create `src/mycommand/command.ts`:

```typescript
import { ReportBuilder } from '../core/report-builder';

export async function runMyCommand(options: MyOptions) {
  const reportBuilder = new ReportBuilder('mycommand', {
    dryRun: options.dryRun,
  });

  // Do work...
  const result = await doSomething();

  // Add to report
  reportBuilder.addTask('task1', {
    success: result.ok,
    message: result.message,
  });

  // Auto-generate report
  reportBuilder.generate();
}
```

### 3. Register in CLI

Add to `src/cli.ts`:

```typescript
program
  .command('mycommand')
  .description('Does something useful')
  .option('--dry-run', 'Preview changes')
  .action(async (opts) => {
    const { runMyCommand } = await import('./mycommand/command');
    await runMyCommand({ dryRun: opts.dryRun });
  });
```

## Best Practices

### Code Organization

1. **One feature per directory** - Don't mix concerns
2. **Flat structure** - Avoid deep nesting
3. **Clear naming** - Name by purpose, not type
4. **Shared code in core/** - Common utilities only

### Report Generation

1. **Use constants** - Define in `report-config.ts`
2. **Use ReportBuilder** - No manual construction
3. **Add task results** - Builder handles formatting
4. **Let it auto-generate** - CLI + Markdown automatic

### Documentation

1. **Auto-generate** - Use `pnpm afena docs`
2. **Don't edit manually** - Changes will be overwritten
3. **Update constants** - Modify source, regenerate
4. **Keep it current** - Regenerate after changes

---

*Auto-generated by `pnpm afena docs` - Do not edit manually*
