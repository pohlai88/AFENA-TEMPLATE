<!-- AUTOGEN:START -->
<!-- Generated by afenda readme gen â€” DO NOT EDIT inside this block -->
<!-- Signature: sha256:93af2dfffffcd3009719992adc140983fa8060da6c9e0d8c19028e1a89292ef6 -->
# @afenda/cli

Package providing **capability or feature modules**. Import from `@afenda/cli` in workspace packages.

## Package Overview

âœ… Has Tests â€¢ ğŸ“š Has Documentation â€¢ ğŸ“ 12 directory areas

### What's Inside

- **Capability or feature modules**
- **Code or doc emitters**
- **Data collectors or introspectors**
- **Domain logic and entities**
- **README generation**

### Directory Structure

```
â””â”€â”€ src/
    â”œâ”€â”€ bundle/ (1 file)
    â”œâ”€â”€ capability/ â€” Capability or feature modules (31 files)
    â”œâ”€â”€ checks/ (2 files)
    â”œâ”€â”€ core/ â€” Core utilities and base types (16 files)
    â”œâ”€â”€ discovery/ (2 files)
    â”œâ”€â”€ docs/ â€” Documentation and guides (1 file)
    â”œâ”€â”€ doctor/ (2 files)
    â”œâ”€â”€ domain/ â€” Domain logic and entities (2 files)
    â”œâ”€â”€ project/ (6 files)
    â”œâ”€â”€ proposal/ (5 files)
    â””â”€â”€ readme/ â€” README generation templates and renderers (7 files)
```

### Source Layout

- **`capability/`** â€” Capability or feature modules
- **`core/`** â€” Core utilities and base types
- **`docs/`** â€” Documentation and guides
- **`domain/`** â€” Domain logic and entities
- **`readme/`** â€” README generation templates and renderers

### Entry Points

- `src/capability/index.ts` â€” barrel export
- `src/checks/index.ts` â€” barrel export
- `src/doctor/index.ts` â€” barrel export
- `src/domain/index.ts` â€” barrel export
- `src/project/index.ts` â€” barrel export
- `src/proposal/index.ts` â€” barrel export

## Usage

```bash
pnpm afenda
```

### Build

```bash
pnpm build
```

### Development

```bash
pnpm dev
```

## Exports

| Subpath | Conditions |
|---|---|
| `.` | default: `dist/index.js`, types: `dist/index.d.ts` |

## Scripts

| Script | Command |
|---|---|
| `build` | `tsup` |
| `dev` | `tsup --watch` |
| `lint` | `eslint src --ext .js,.jsx,.ts,.tsx --cache --concurrency=auto` |
| `lint:ci` | `eslint src --ext .js,.jsx,.ts,.tsx --rule 'import/no-cycle: error'` |
| `lint:fix` | `eslint src --ext .js,.jsx,.ts,.tsx --cache --fix` |
| `meta:check` | `node dist/index.js meta check` |
| `test` | `vitest run` |
| `test:coverage` | `vitest run --coverage` |
| `test:watch` | `vitest watch` |
| `type-check` | `tsc --noEmit` |

## Architecture

CLI tool (Commander.js). Commands and capabilities are registered in `src/`. Use `pnpm <bin>` to run.

## Testing

Run tests:

```bash
pnpm test
```

Watch mode:

```bash
pnpm test:watch
```

Coverage report:

```bash
pnpm test:coverage
```

## Dependencies

| Package | Version |
|---|---|
| `afenda-canon` | `workspace:*` |
| `commander` | `catalog:` |
| `cosmiconfig` | `catalog:` |
| `execa` | `catalog:` |
| `fast-glob` | `catalog:` |
| `listr2` | `catalog:` |
| `picocolors` | `catalog:` |
| `semver` | `catalog:` |
| `strip-ansi` | `catalog:` |
| `zod` | `catalog:` |

## Related Packages

- `afenda-canon`
- `afenda-eslint-config`
- `afenda-typescript-config`

## Contributing

### Development Workflow

1. Make changes to source files
2. Run `pnpm lint:fix` to fix linting issues
3. Run `pnpm type-check` to verify types

### Code Quality

- All code must pass ESLint checks
- All code must pass TypeScript type checking

<!-- AUTOGEN:END -->

---

# ğŸ”§ afenda CLI - Enterprise Command Reference

<div align="center">

![CLI](https://img.shields.io/badge/cli-Commander.js-green?style=flat-square)
![TypeScript](https://img.shields.io/badge/language-TypeScript-blue?style=flat-square)
![Commands](https://img.shields.io/badge/commands-20+-success?style=flat-square)

**Unified CLI for capability governance, README generation, metadata validation,
and architecture documentation**

[Commands](#-command-reference) â€¢
[Architecture Docs](#-architecture-doc-generation) â€¢
[Workflows](#-common-workflows) â€¢ [CI/CD](#-cicd-integration) â€¢
[Troubleshooting](#-troubleshooting)

</div>

---

## ğŸ“‹ Table of Contents

- [Overview](#-overview)
- [Quick Start](#-quick-start)
- [Command Reference](#-command-reference)
- [Architecture Doc Generation](#-architecture-doc-generation)
- [Common Workflows](#-common-workflows)
- [CI/CD Integration](#-cicd-integration)
- [Troubleshooting](#-troubleshooting)
- [Advanced Usage](#-advanced-usage)

---

## ğŸ¯ Overview

afenda CLI provides **unified tooling** for the AFENDA-NEXUS monorepo:

### Core Capabilities

âœ… **Capability Governance** - Validate and generate capability documentation\
âœ… **README Generation** - Auto-generate consistent package READMEs\
âœ… **Metadata Validation** - Ensure quality standards (VIS-00 to VIS-04)\
âœ… **Architecture Documentation** - Generate architecture docs from code\
âœ… **Housekeeping Automation** - Run invariant checks (E1-E7, H00-H02)

### Design Principles

ğŸ”§ **Declarative Configuration** - All commands defined in `report-config.ts`\
ğŸ“Š **Consistent Reporting** - Unified CLI and Markdown output\
âš¡ **Fast Execution** - Optimized for monorepo scale (38 packages, 83K+ LOC)\
ğŸ¨ **Professional UX** - Color-coded output with status indicators

---

## ğŸš€ Quick Start

### Installation

```bash
# From workspace root
pnpm install

# Or add as dev dependency from another workspace package:
pnpm -w add -D @afenda/cli
```

### Verify Installation

```bash
# Check CLI version
pnpm afenda --version

# List all commands
pnpm afenda --help
```

### Run Your First Command

```bash
# Generate package READMEs
pnpm afenda readme gen

# Output: âœ… Generated READMEs for 38 packages
```

---

## ğŸ“– Command Reference

### Metadata Commands

#### `afenda meta gen` - Generate Capability Documentation

Scans the entire codebase and generates comprehensive capability documentation.

**Usage**:

```bash
pnpm afenda meta gen [--deep]
```

**Options**:

- `--deep` - Perform deep scanning (includes cross-package analysis)

**Generated Files**:

- `.afenda/capability.ledger.json` - Raw capability data
- `.afenda/capability.matrix.md` - Coverage matrix table
- `.afenda/codebase.manifest.json` - Package graph & schema catalog
- `.afenda/capability.mermaid.md` - Mermaid diagram
- `.agents/context/capability-map.md` - AI agent context

**Example Output**:

```
ğŸ” Scanning codebase...
âœ… Found 12 capability surfaces
âœ… Found 14 UI surfaces
âœ… Scanned 38 packages, 175 tables, 83,229 LOC

ğŸ“Š Summary:
   24 covered | 8 orphaned | 0 phantom | 2 excepted

âœ… Wrote .afenda/capability.ledger.json
âœ… Wrote .afenda/capability.matrix.md
âœ… Wrote .afenda/codebase.manifest.json
âœ… Wrote .agents/context/capability-map.md
```

**When to Use**:

- After adding new capabilities
- Before releases to update documentation
- When onboarding AI agents
- During architecture reviews

---

#### `afenda meta check` - Validate Metadata Quality

Runs comprehensive metadata validation checks (VIS-00 through VIS-04).

**Usage**:

```bash
pnpm afenda meta check [--deep] [--json]
```

**Options**:

- `--deep` - Enable deep validation (cross-package checks)
- `--json` - Output results as JSON

**Validation Checks**:

| Check      | Description                    |
| ---------- | ------------------------------ |
| **VIS-00** | Package metadata completeness  |
| **VIS-01** | Capability annotation presence |
| **VIS-02** | Capability surface coverage    |
| **VIS-03** | UI surface documentation       |
| **VIS-04** | Cross-package consistency      |

**Example Output**:

```
ğŸ” Running metadata checks...

âœ… VIS-00: Package metadata (38/38 packages)
âœ… VIS-01: Capability annotations (24/24 surfaces)
âš ï¸  VIS-02: Surface coverage (16/24 covered, 8 orphaned)
âœ… VIS-03: UI documentation (14/14 surfaces)
âœ… VIS-04: Cross-package refs (100% valid)

Summary: 4/5 checks passed
Exit code: 1 (failures detected)
```

**CI/CD Usage**:

```yaml
# .github/workflows/ci.yml
- name: Validate Metadata
  run: pnpm afenda meta check
```

---

#### `afenda meta fix` - Autofix Metadata Issues

Automatically fixes missing capability annotations.

**Usage**:

```bash
pnpm afenda meta fix [--dry-run]
```

**Options**:

- `--dry-run` - Preview changes without writing

**Example Output**:

```
ğŸ”§ Fixing metadata issues...

ğŸ“ packages/accounting/src/index.ts
   + Added @capability: accounting/general-ledger

ğŸ“ packages/crm/src/index.ts
   + Added @capability: crm/contact-management

âœ… Fixed 2 files (dry-run)
```

---

#### `afenda meta matrix` - Generate Capability Matrix

Generates and prints the capability coverage matrix.

**Usage**:

```bash
pnpm afenda meta matrix
```

**Example Output**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Capability          â”‚ Surface    â”‚ UI       â”‚ Status  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ accounting/gl       â”‚ âœ… GL.ts   â”‚ âœ… Page  â”‚ Covered â”‚
â”‚ crm/contacts        â”‚ âœ… CRM.ts  â”‚ âŒ       â”‚ Orphanedâ”‚
â”‚ workflow/approval   â”‚ âŒ         â”‚ âœ… Page  â”‚ Phantom â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### `afenda meta manifest` - Generate Codebase Manifest

Generates comprehensive codebase manifest with package graph and schema catalog.

**Usage**:

```bash
pnpm afenda meta manifest
```

**Generated Data**:

- Package dependency graph
- Database schema catalog (175 tables)
- Lines of code statistics (83K+ LOC)
- Technology stack inventory

**Output**: `.afenda/codebase.manifest.json`

---

### README Commands

#### `afenda readme gen` - Generate Package READMEs

Auto-generates README files for all packages based on introspection and
templates.

**Usage**:

```bash
pnpm afenda readme gen [--package <name>] [--dry-run]
```

**Options**:

- `--package <name>` - Generate README for specific package only
- `--dry-run` - Preview changes without writing

**Example Output**:

```
ğŸ“ Generating READMEs...

âœ… packages/accounting/README.md
âœ… packages/canon/README.md
...
âœ… Generated 38 READMEs
```

**Generated Sections**:

- Package overview with badges
- Directory structure
- Entry points and exports
- Scripts reference
- Dependencies table
- Contributing guidelines

**Single Package Example**:

```bash
pnpm afenda readme gen --package afenda-accounting
```

---

#### `afenda readme sync` - Sync Existing READMEs

Updates auto-generated blocks in existing READMEs only (preserves manual
content).

**Usage**:

```bash
pnpm afenda readme sync [--dry-run]
```

**Options**:

- `--dry-run` - Preview changes without writing

**How It Works**:

- Finds the autogen block markers (AUTOGEN:START / AUTOGEN:END)
- Regenerates content between START and END markers
- Preserves all manual content outside blocks

**Example Output**:

```
ğŸ”„ Syncing README auto-gen blocks...

âœ… packages/accounting/README.md (updated auto-gen block, 142 â†’ 156 lines)
âœ… packages/canon/README.md (no changes needed)
âš ï¸  packages/crm/README.md (missing auto-gen markers, skipped)

âœ… Synced 38 READMEs
```

---

#### `afenda readme check` - Validate READMEs

Validates READMEs against Definition of Done criteria.

**Usage**:

```bash
pnpm afenda readme check
```

**Validation Rules**:

- âœ… Auto-gen block present and valid
- âœ… Required sections exist (Overview, Usage, Architecture)
- âœ… No broken internal links
- âœ… Consistent formatting
- âœ… Up-to-date with package.json

**Example Output**:

```
ğŸ” Validating READMEs...

âœ… packages/accounting/README.md
âœ… packages/canon/README.md
âš ï¸  packages/crm/README.md
   - Missing "Architecture" section
   - Broken link: [database](../databse/README.md)

Summary: 36/38 valid
```

---

### Housekeeping Commands

#### `afenda housekeeping` - Run Invariant Checks

Runs comprehensive codebase invariant checks.

**Usage**:

```bash
pnpm afenda housekeeping
```

**Checks Performed**:

| Check   | Description                       |
| ------- | --------------------------------- |
| **E1**  | All packages export from index.ts |
| **E2**  | No circular imports               |
| **E3**  | Consistent naming conventions     |
| **E4**  | Required package.json fields      |
| **E5**  | Valid dependency versions         |
| **E6**  | Exports match documentation       |
| **E7**  | Type definitions present          |
| **H00** | Dependency health                 |
| **H01** | Security vulnerabilities          |
| **H02** | License compliance                |

**Example Output**:

```
ğŸ§¹ Running housekeeping checks...

âœ… E1: Package exports (38/38 valid)
âœ… E2: No circular imports (0 cycles found)
âœ… E3: Naming conventions (all packages compliant)
âš ï¸  E4: Package.json fields (2 packages missing "repository")
âœ… E5: Dependency versions (all catalog:* valid)
âœ… E6: Export documentation (100% match)
âœ… E7: Type definitions (all packages have .d.ts)
âœ… H00: Dependency health (no deprecated packages)
âœ… H01: Security (0 vulnerabilities)
âœ… H02: Licenses (all MIT/Apache-2.0)

Summary: 9/10 checks passed
```

---

### Bundle Command

#### `afenda bundle` - Run All Maintenance Tasks

Executes all maintenance tasks in the correct order.

**Usage**:

```bash
pnpm afenda bundle [--dry-run]
```

**Tasks Executed** (in order):

1. **README Generation** - Generate package READMEs
2. **Metadata Validation** - Run VIS-00 to VIS-04 checks
3. **Housekeeping** - Run invariant checks (E1-E7, H00-H02)
4. **Capability Generation** - Update capability documentation

**Example Output**:

```
ğŸ”§ Running bundle tasks...

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Bundle                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ğŸ“ README Generation                    â”‚
â”‚    Generated 38 READMEs                    â”‚
â”‚ âœ… ğŸ” Metadata Checks                      â”‚
â”‚    All checks passed                       â”‚
â”‚ âš ï¸  ğŸ§¹ Housekeeping                        â”‚
â”‚    9/10 checks passed                      â”‚
â”‚ âœ… ğŸ“Š Capability Generation                â”‚
â”‚    Updated .afenda/ documentation           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Summary: 3/4 tasks fully successful
```

**When to Use**:

- Before committing major changes
- Before releases
- Weekly maintenance runs
- CI/CD quality gates

---

## ğŸ“š Architecture Doc Generation

Running `afenda readme gen` auto-generates `.architecture/*.architecture.md`
files from live codebase introspection.

Each doc combines:

- **Static descriptions** from `ARCH_REGISTRY` (overview, design decisions, data
  flow, cross-refs)
- **Live introspected data** (barrel exports, source dirs, types, invariants,
  deps, patterns, test counts)

### Adding a New Architecture Document

1. Open `tools/afenda-cli/src/meta/emitters/architecture.ts`
2. Add an entry to `ARCH_REGISTRY` keyed by **package name** (from
   `package.json`) or **relative path** (e.g. `apps/web`):

```ts
'afenda-my-package': {
  title: 'My Package',
  filename: 'my-package.architecture',   // â†’ .architecture/my-package.architecture.md
  purpose: 'One-line purpose statement.',
  overview: `
Markdown describing the architecture overview.
`,
  decisions: `
- **Decision 1**: Explanation
- **Decision 2**: Explanation
`,
  dataFlow: `           // optional
\`\`\`
A â†’ B â†’ C
\`\`\`
`,
  integrations: `...`,  // optional
  crossRefs: ['database.architecture.md', 'crud.architecture.md'],  // optional
},
```

3. Rebuild the CLI: `pnpm build` (from `tools/afenda-cli`)
4. Run: `pnpm afenda readme gen`

### Currently Registered Packages

| Registry Key       | Output File                 | Package              |
| ------------------ | --------------------------- | -------------------- |
| `afenda-canon`     | `canon.architecture.md`     | `packages/canon`     |
| `afenda-crud`      | `crud.architecture.md`      | `packages/crud`      |
| `afenda-database`  | `database.architecture.md`  | `packages/database`  |
| `afenda-search`    | `search.architecture.md`    | `packages/search`    |
| `afenda-workflow`  | `workflow.architecture.md`  | `packages/workflow`  |
| `afenda-migration` | `migration.architecture.md` | `packages/migration` |
| `afenda-logger`    | `logger.architecture.md`    | `packages/logger`    |
| `afenda-ui`        | `ui.architecture.md`        | `packages/ui`        |
| `apps/web`         | `route.architecture.md`     | `apps/web`           |
| `tools/afenda-cli` | `meta.architecture.md`      | `tools/afenda-cli`   |

### Manual Architecture Docs (not auto-generated)

These files in `.architecture/` are **not** in `ARCH_REGISTRY` and are never
overwritten:

- `business.logic.architecture.md` â€” cross-cutting CRUD-SAP kernel pattern
- `multitenancy.architecture.md` â€” shared schema + RLS model
- `db.schema.governance.md` â€” schema lint rules and governance

---

## ğŸ”„ Common Workflows

### Workflow 1: Daily Development

```bash
# Morning: Validate metadata
pnpm afenda meta check

# After changes: Regenerate READMEs
pnpm afenda readme gen

# Before committing: Run housekeeping
pnpm afenda housekeeping
```

### Workflow 2: Weekly Maintenance

```bash
# Run all maintenance tasks
pnpm afenda bundle

# Review generated reports
cat .afenda/capability.matrix.md
```

### Workflow 3: Release Preparation

```bash
# 1. Generate fresh capability map
pnpm afenda meta gen

# 2. Validate all metadata
pnpm afenda meta check

# 3. Regenerate all documentation
pnpm afenda readme gen

# 4. Run full housekeeping
pnpm afenda housekeeping

# 5. Review outputs
ls -la .afenda/
```

### Workflow 4: Package-Specific Updates

```bash
# Update single package README
pnpm afenda readme gen --package afenda-accounting

# Check single package metadata
pnpm afenda meta check --package afenda-accounting
```

### Workflow 5: Dry-Run Preview

```bash
# Preview changes before applying
pnpm afenda bundle --dry-run

# Preview README changes
pnpm afenda readme gen --dry-run

# Preview metadata fixes
pnpm afenda meta fix --dry-run
```

---

## âš™ï¸ CI/CD Integration

### GitHub Actions

#### Full Quality Check

```yaml
# .github/workflows/quality.yml
name: Quality Checks

on: [push, pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install

      - name: Validate metadata
        run: pnpm afenda meta check

      - name: Run housekeeping checks
        run: pnpm afenda housekeeping

      - name: Validate READMEs
        run: pnpm afenda readme check
```

#### Documentation Sync Check

```yaml
# .github/workflows/docs-sync.yml
name: Documentation Sync

on: [pull_request]

jobs:
  docs-sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup environment
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Install dependencies
        run: pnpm install

      - name: Generate READMEs (dry-run)
        run: pnpm afenda readme gen --dry-run

      - name: Check for outdated READMEs
        run: |
          if ! git diff --quiet; then
            echo "âŒ READMEs are out of sync. Run 'pnpm afenda readme gen'"
            exit 1
          fi
```

#### Capability Documentation Update

```yaml
# .github/workflows/capability-docs.yml
name: Update Capability Docs

on:
  push:
    branches: [main]

jobs:
  update-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup environment
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Install dependencies
        run: pnpm install

      - name: Generate capability documentation
        run: pnpm afenda meta gen

      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add .afenda/ .agents/
          git commit -m "docs: update capability documentation" || true
          git push
```

### Pre-commit Hooks

Add to `.husky/pre-commit`:

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Validate metadata before commit
pnpm afenda meta check || exit 1

# Regenerate READMEs if needed
pnpm afenda readme sync
```

---

## ğŸ”§ Troubleshooting

### Common Issues

#### `afenda` command not found

**Symptoms**:

```bash
$ pnpm afenda
Command 'afenda' not found
```

**Solution**:

```bash
# Reinstall dependencies to link CLI
pnpm install

# Verify installation
pnpm afenda --version
```

---

#### Generated files are empty

**Symptoms**:

```bash
$ pnpm afenda meta gen
âœ… Wrote .afenda/capability.ledger.json (0 KB)
```

**Diagnosis**:

```bash
# Run with verbose output
pnpm afenda meta gen --verbose

# Check package metadata
cat packages/my-package/package.json | grep "afenda"
```

**Solution**:

- Ensure packages have required metadata in `package.json`
- Verify capability annotations exist in source files
- Check file permissions for write access

---

#### Metadata validation failures

**Symptoms**:

```bash
$ pnpm afenda meta check
âš ï¸ VIS-02: Surface coverage (8 orphaned surfaces)
Exit code: 1
```

**Diagnosis**:

```bash
# View detailed failure report
pnpm afenda meta check --json > report.json
cat report.json | jq '.failures'
```

**Solution**:

```bash
# Autofix missing annotations
pnpm afenda meta fix

# Or manually add capability annotations
# In your source file:
/**
 * @capability: accounting/general-ledger
 */
export class GL { ... }
```

---

#### README sync conflicts

**Symptoms**:

```bash
$ pnpm afenda readme sync
âš ï¸ packages/accounting/README.md has merge conflicts in auto-gen block
```

**Solution**:

```bash
# 1. Resolve Git conflicts manually
# 2. Remove auto-gen markers if corrupted
# 3. Regenerate from scratch
pnpm afenda readme gen --package afenda-accounting
```

---

#### Performance issues

**Symptoms**:

```bash
$ pnpm afenda meta gen
# Takes >60 seconds
```

**Diagnosis**:

```bash
# Check codebase size
pnpm afenda meta manifest | jq '.stats'
```

**Solution**:

- Use `--no-deep` flag to skip deep scanning
- Run on specific packages only
- Consider upgrading Node.js version
- Check for large files in packages

---

### Debug Mode

Enable verbose logging for troubleshooting:

```bash
# Set debug environment variable
DEBUG=afenda:* pnpm afenda meta gen

# Or use verbose flag
pnpm afenda meta gen --verbose
```

---

## ğŸ“ Advanced Usage

### Programmatic API

Use afenda CLI commands programmatically:

```typescript
import { runMetaGen, runReadmeGen } from '@afenda/cli';

// Generate capability documentation
await runMetaGen({ deep: true });

// Generate READMEs for specific package
await runReadmeGen({ package: 'afenda-accounting' });
```

### Custom Validators

Add custom metadata validators:

```typescript
// src/validators/custom-validator.ts
export function validateCustomRule(pkg: Package): ValidationResult {
  if (!pkg.metadata.customField) {
    return {
      success: false,
      message: 'Missing customField in package.json',
    };
  }
  return { success: true };
}
```

Register in `src/meta/check.ts`:

```typescript
import { validateCustomRule } from '../validators/custom-validator';

const validators = [...defaultValidators, validateCustomRule];
```

### Custom Report Formats

Create custom report formats:

```typescript
// src/reporters/custom-reporter.ts
export class CustomReporter {
  generate(data: CapabilityData): string {
    // Custom logic to generate report
    return JSON.stringify(data, null, 2);
  }
}
```

---

<div align="center">

**ğŸ“ Documentation Reference**

[Tools README](../README.md) â€¢ [Development Guide](../GUIDE.md) â€¢
[Quality Metrics](../quality-metrics/README.md) â€¢
[Contributing](../../CONTRIBUTING.md)

---

**Last Updated**: Auto-generated on save\
**Maintained By**: AFENDA-NEXUS Tools Team

[â¬† Back to Top](#-afenda-cli---enterprise-command-reference)

</div>
