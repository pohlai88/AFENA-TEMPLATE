<!-- AUTOGEN:START -->
<!-- Generated by afenda readme gen ‚Äî DO NOT EDIT inside this block -->
<!-- Signature: sha256:de34355d08f03250386371168ef5d7b517b7287c73bef1ff14297b69686e89f1 -->

# afenda-workflow

## Package Overview

üìÅ 1 Subdirectories

### What's Inside

- Configuration
- Main exports
- Schemas
- Type definitions

### Directory Structure

```
src/
‚îî‚îÄ‚îÄ v2/
```

### Entry Points

- `src/index.ts`
- `src/v2/index.ts`
- `src/v2/nodes/index.ts`

## Usage

```ts
import {/* ... */} from "afenda-workflow";
```

## API

See source files for available exports.

## Installation

```bash
pnpm -w add afenda-workflow
```

## Exports

| Subpath | Conditions                                         |
| ------- | -------------------------------------------------- |
| `.`     | default: `./src/index.ts`, types: `./src/index.ts` |

## Scripts

| Script       | Command                                                            |
| ------------ | ------------------------------------------------------------------ |
| `build`      | `tsup`                                                             |
| `dev`        | `tsup --watch`                                                     |
| `lint`       | `eslint . --ext .js,.jsx,.ts,.tsx --cache --concurrency=auto`      |
| `lint:ci`    | `eslint . --ext .js,.jsx,.ts,.tsx --rule 'import/no-cycle: error'` |
| `lint:fix`   | `eslint . --ext .js,.jsx,.ts,.tsx --cache --fix`                   |
| `type-check` | `tsc --noEmit`                                                     |

## Architecture

```
src/
‚îî‚îÄ‚îÄ index.ts    # Public API
```

## Dependencies

| Package           | Version       |
| ----------------- | ------------- |
| `afenda-canon`    | `workspace:*` |
| `afenda-database` | `workspace:*` |
| `drizzle-orm`     | `^0.44.0`     |
| `zod`             | `catalog:`    |

## Related Packages

- `afenda-canon`
- `afenda-database`
- `afenda-eslint-config`
- `afenda-typescript-config`

## Contributing

### Development Workflow

1. Make changes to source files
2. Run `pnpm lint:fix` to fix linting issues
3. Run `pnpm type-check` to verify types
4. Run `pnpm test` to verify tests pass
5. Run `pnpm build` to verify build succeeds

### Code Quality

- All code must pass ESLint checks
- All code must pass TypeScript type checking
- All tests must pass
- Maintain or improve test coverage

<!-- AUTOGEN:END -->

# afenda-workflow

Rule engine for before/after mutation hooks in the afenda Interaction Kernel.

## Public API

### Engine

- `evaluateRules(timing, spec, entity, ctx)` ‚Äî evaluate all matching rules for a
  mutation

### Registry

- `registerRule(rule)` ‚Äî register a workflow rule (sorted by priority)
- `unregisterRule(id)` ‚Äî remove a rule by ID
- `getRegisteredRules()` ‚Äî list all registered rules
- `clearRules()` ‚Äî remove all rules

### Built-in Conditions

- `always` / `never` ‚Äî constant matchers
- `fieldEquals(field, value)` ‚Äî input field equality
- `fieldChanged(field)` ‚Äî field differs from entity snapshot
- `actorHasRole(role)` ‚Äî actor role check
- `allOf(...conds)` / `anyOf(...conds)` ‚Äî AND/OR combinators

## Usage

```typescript
import { fieldEquals, registerRule } from "afenda-workflow";

registerRule({
  id: "require-email",
  name: "Require email on create",
  timing: "before",
  entityTypes: ["contacts"],
  verbs: ["create"],
  priority: 50,
  enabled: true,
  condition: fieldEquals("email", undefined),
  action: () => ({ ok: false, message: "Email is required" }),
});
```

## How It Works

- **Before-rules**: Can block or enrich mutations (runs inside `mutate()` before
  transaction)
- **After-rules**: Fire-and-forget side effects (runs after transaction commit,
  errors swallowed)

## Dependencies

`afenda-canon`
