<!-- AUTOGEN:START -->
<!-- Generated by afenda readme gen ‚Äî DO NOT EDIT inside this block -->
<!-- Signature: sha256:80f4cf4c242cb41916d7d95bea76092972c060ac6c21022dd8ea6dc7b03b43a5 -->

# afenda-advisory

## Package Overview

üìÅ 5 Subdirectories

### What's Inside

- Configuration
- Main exports
- Type definitions

### Directory Structure

```
src/
‚îú‚îÄ‚îÄ detectors/
‚îú‚îÄ‚îÄ explain/
‚îú‚îÄ‚îÄ forecasters/
‚îú‚îÄ‚îÄ rules/
‚îî‚îÄ‚îÄ scoring/
```

### Entry Points

- `src/index.ts`

## Usage

```ts
import {/* ... */} from "afenda-advisory";
```

## API

See source files for available exports.

## Installation

```bash
pnpm -w add afenda-advisory
```

## Exports

| Subpath | Conditions                                         |
| ------- | -------------------------------------------------- |
| `.`     | default: `./src/index.ts`, types: `./src/index.ts` |

## Scripts

| Script       | Command                                                            |
| ------------ | ------------------------------------------------------------------ |
| `build`      | `tsup`                                                             |
| `dev`        | `tsup --watch`                                                     |
| `lint`       | `eslint . --ext .js,.jsx,.ts,.tsx --cache --concurrency=auto`      |
| `lint:ci`    | `eslint . --ext .js,.jsx,.ts,.tsx --rule 'import/no-cycle: error'` |
| `lint:fix`   | `eslint . --ext .js,.jsx,.ts,.tsx --cache --fix`                   |
| `type-check` | `tsc --noEmit`                                                     |

## Architecture

```
src/
‚îî‚îÄ‚îÄ index.ts    # Public API
```

## Dependencies

| Package           | Version       |
| ----------------- | ------------- |
| `afenda-canon`    | `workspace:*` |
| `afenda-database` | `workspace:*` |
| `drizzle-orm`     | `^0.44.0`     |

## Related Packages

- `afenda-canon`
- `afenda-database`
- `afenda-eslint-config`
- `afenda-typescript-config`

## Contributing

### Development Workflow

1. Make changes to source files
2. Run `pnpm lint:fix` to fix linting issues
3. Run `pnpm type-check` to verify types
4. Run `pnpm test` to verify tests pass
5. Run `pnpm build` to verify build succeeds

### Code Quality

- All code must pass ESLint checks
- All code must pass TypeScript type checking
- All tests must pass
- Maintain or improve test coverage

<!-- AUTOGEN:END -->

# afenda-advisory

Deterministic forecast & detection engine ‚Äî math-first, auditable,
advisory-only.

## Public API

### Detectors

- `detectEwma(series, opts)` ‚Äî Exponentially Weighted Moving Average
  (drift/spike)
- `detectCusum(series, opts)` ‚Äî Cumulative Sum (change-point detection)
- `detectMad(values, opts)` ‚Äî Median Absolute Deviation (robust outlier
  detection)

### Forecasters

- `forecastSes(series, horizon, opts)` ‚Äî Simple Exponential Smoothing
- `forecastHolt(series, horizon, opts)` ‚Äî Holt's linear trend
- `forecastHoltWinters(series, horizon, season, opts)` ‚Äî Holt-Winters seasonal
  (P10/P50/P90)

### Scoring

- `zScore(value, mean, stdDev)` / `robustZScore(value, median, mad)` ‚Äî z-score
  calculations
- `confidenceBands(forecast, residuals)` ‚Äî quantile bands (P10/P50/P90)
- `predictionInterval(forecast, residuals, alpha)` ‚Äî prediction intervals

### Rules

- `registerRuleCheck(check)` / `evaluateRuleChecks(context)` ‚Äî business
  invariant checks
- `creditLimitRule` / `agingThresholdRule` ‚Äî built-in rule examples

### Evidence & Explanation

- `buildEvidence(input)` ‚Äî SHA-256 hashed evidence records
- `renderExplanation(method, params, score)` ‚Äî deterministic plain-English
  explanations
- `writeAdvisory(input)` ‚Äî write advisory + evidence to DB (fingerprint dedupe)

## Usage

```typescript
import { detectEwma, buildFingerprint, writeAdvisory } from 'afenda-advisory';

const result = detectEwma(series, { span: 20, threshold: 2.5 });
if (result.isAnomaly) {
  const fingerprint = buildFingerprint({ type: 'anomaly.revenue.monthly', orgId, method: 'EWMA' });
  await writeAdvisory({ fingerprint, type: 'anomaly.revenue.monthly', ... });
}
```

## Invariants

- **INVARIANT-P01**: Only writes to `advisories` + `advisory_evidence`. Never
  domain tables.
- **INVARIANT-P02**: `advisory_evidence` is append-only (no UPDATE, no DELETE).
- **INVARIANT-P03**: Open/ack advisories deduplicated by
  `(org_id, fingerprint)`.

## Dependencies

`afenda-canon`, `afenda-database`, `drizzle-orm`
