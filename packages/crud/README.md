<!-- AUTOGEN:START -->
<!-- Generated by afena readme gen — DO NOT EDIT inside this block -->
<!-- Signature: sha256:c17b681b0e43b2a3d586ffe1897cb3e231ce230e43d690f1d27113f12a514e2a -->
# afena-crud

## Usage

```ts
import { /* ... */ } from 'afena-crud';
```

## API

See source files for available exports.

## Installation

```bash
pnpm -w add afena-crud
```

## Exports

| Subpath | Conditions |
|---|---|
| `.` | default: `./src/index.ts`, types: `./src/index.ts` |

## Scripts

| Script | Command |
|---|---|
| `build` | `tsup` |
| `dev` | `tsup --watch` |
| `lint` | `eslint . --ext .js,.jsx,.ts,.tsx --cache --concurrency=auto` |
| `lint:ci` | `eslint . --ext .js,.jsx,.ts,.tsx --rule 'import/no-cycle: error'` |
| `lint:fix` | `eslint . --ext .js,.jsx,.ts,.tsx --cache --fix` |
| `test` | `vitest run` |
| `type-check` | `tsc --noEmit` |

## Dependencies

| Package | Version |
|---|---|
| `afena-canon` | `workspace:*` |
| `afena-database` | `workspace:*` |
| `afena-logger` | `workspace:*` |
| `afena-workflow` | `workspace:*` |
| `drizzle-orm` | `^0.44.0` |
| `fast-json-patch` | `catalog:` |

## Related Packages

- `afena-canon`
- `afena-database`
- `afena-eslint-config`
- `afena-logger`
- `afena-typescript-config`
- `afena-vitest-config`
- `afena-workflow`

<!-- AUTOGEN:END -->

# afena-crud

The Afena Interaction Kernel (AIK) — deterministic mutation ledger for all domain data writes.

## Public API

Only 3 functions are exported (K-05):

- `mutate(spec, ctx)` — the single entry point for all domain writes (create, update, delete, restore)
- `readEntity(type, id, ctx)` — read a single entity by ID
- `listEntities(type, ctx, options)` — list entities with filtering/pagination

## Usage

```typescript
import { mutate, readEntity } from 'afena-crud';

const receipt = await mutate({
  actionType: 'contacts.create',
  entityRef: { type: 'contacts' },
  input: { name: 'Acme Corp', email: 'hello@acme.com' },
}, ctx);
```

## Kernel Invariants

- **K-01**: `mutate()` is the only way to write domain data
- **K-02**: Single DB transaction per mutation
- **K-03**: Always writes `audit_logs` + `entity_versions`
- **K-04**: `expectedVersion` required on update/delete/restore
- **K-11**: Allowlist input + kernel backstop strips system columns

## Dependencies

`afena-canon`, `afena-database`, `afena-logger`, `drizzle-orm`, `fast-json-patch`
