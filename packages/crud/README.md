<!-- AUTOGEN:START -->
<!-- Generated by afena readme gen â€” DO NOT EDIT inside this block -->
<!-- Signature: sha256:59449bd4d7fdef00555cadcbbc7ed24a97a876696deddd8db15af361639bc3cf -->
# afena-crud

## Package Overview

âœ… Has Tests â€¢ ğŸ“ 4 Subdirectories

### What's Inside

- Configuration
- Main exports
- Services
- Type definitions

### Directory Structure

```
src/
â”œâ”€â”€ __tests__/
â”œâ”€â”€ handlers/
â”œâ”€â”€ registries/
â””â”€â”€ services/
```

### Entry Points

- `src/index.ts`

## Usage

```ts
import { /* ... */ } from 'afena-crud';
```

## API

See source files for available exports.

## Installation

```bash
pnpm -w add afena-crud
```

## Exports

| Subpath | Conditions |
|---|---|
| `.` | default: `./src/index.ts`, types: `./src/index.ts` |

## Scripts

| Script | Command |
|---|---|
| `build` | `tsup` |
| `dev` | `tsup --watch` |
| `lint` | `eslint . --ext .js,.jsx,.ts,.tsx --cache --concurrency=auto` |
| `lint:ci` | `eslint . --ext .js,.jsx,.ts,.tsx --rule 'import/no-cycle: error'` |
| `lint:fix` | `eslint . --ext .js,.jsx,.ts,.tsx --cache --fix` |
| `test` | `vitest run` |
| `type-check` | `tsc --noEmit` |

## Architecture

```
src/
â”œâ”€â”€ services/   # Business logic
â””â”€â”€ index.ts    # Public API
```

## Testing

Run tests:

```bash
pnpm test
```

## Dependencies

| Package | Version |
|---|---|
| `afena-canon` | `workspace:*` |
| `afena-database` | `workspace:*` |
| `afena-logger` | `workspace:*` |
| `afena-workflow` | `workspace:*` |
| `drizzle-orm` | `^0.44.0` |
| `fast-json-patch` | `catalog:` |
| `ioredis` | `^5.4.1` |

## Related Packages

- `afena-canon`
- `afena-database`
- `afena-eslint-config`
- `afena-logger`
- `afena-typescript-config`
- `afena-workflow`

## Contributing

### Development Workflow

1. Make changes to source files
2. Run `pnpm lint:fix` to fix linting issues
3. Run `pnpm type-check` to verify types
4. Run `pnpm test` to verify tests pass
5. Run `pnpm build` to verify build succeeds

### Code Quality

- All code must pass ESLint checks
- All code must pass TypeScript type checking
- All tests must pass
- Maintain or improve test coverage

<!-- AUTOGEN:END -->

# afena-crud

The Afena Interaction Kernel (AIK) â€” deterministic mutation ledger for all domain data writes.

## Public API

Only 3 functions are exported (K-05):

- `mutate(spec, ctx)` â€” the single entry point for all domain writes (create, update, delete, restore)
- `readEntity(type, id, ctx)` â€” read a single entity by ID
- `listEntities(type, ctx, options)` â€” list entities with filtering/pagination

## Usage

```typescript
import { mutate, readEntity } from 'afena-crud';

const receipt = await mutate({
  actionType: 'contacts.create',
  entityRef: { type: 'contacts' },
  input: { name: 'Acme Corp', email: 'hello@acme.com' },
}, ctx);
```

## Kernel Invariants

- **K-01**: `mutate()` is the only way to write domain data
- **K-02**: Single DB transaction per mutation
- **K-03**: Always writes `audit_logs` + `entity_versions`
- **K-04**: `expectedVersion` required on update/delete/restore
- **K-11**: Allowlist input + kernel backstop strips system columns

## Dependencies

`afena-canon`, `afena-database`, `afena-logger`, `drizzle-orm`, `fast-json-patch`
