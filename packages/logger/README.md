<!-- AUTOGEN:START -->
<!-- Generated by afenda readme gen ‚Äî DO NOT EDIT inside this block -->
<!-- Signature: sha256:b0dd0ed7d180e787ca1a91add47d9867be8c79c5d509c8d7adc553f36606d0b1 -->
# afenda-logger

Package providing **main exports (barrel from index)**. Import from `afenda-logger` in workspace packages.

## Package Overview

üìÅ 1 directory areas

### What's Inside

- **Main exports (barrel from index)**

### Directory Structure

```
‚îî‚îÄ‚îÄ src/ (6 files)
```

### Entry Points

- `src/index.ts` ‚Äî barrel export

## Usage

```ts
import { /* ... */ } from 'afenda-logger';
```

This package exposes:

- Main exports (barrel from index)

## API

See `src/index.ts` and subpaths for full exports.

## Installation

```bash
pnpm -w add afenda-logger
```

### Peer Dependencies

This package requires the following peer dependencies:

- `pino-pretty`

## Exports

| Subpath | Conditions |
|---|---|
| `.` | default: `./src/index.ts`, types: `./src/index.ts` |

## Scripts

| Script | Command |
|---|---|
| `build` | `tsup` |
| `dev` | `tsup --watch` |
| `lint` | `eslint . --ext .js,.jsx,.ts,.tsx --cache` |
| `lint:fix` | `eslint . --ext .js,.jsx,.ts,.tsx --fix` |
| `type-check` | `tsc --noEmit` |

## Architecture

Source is organized by responsibility. Key areas:

- **`src/index.ts`** ‚Äî Public API barrel

## Dependencies

| Package | Version |
|---|---|
| `pino` | `catalog:` |
| `pino-abstract-transport` | `catalog:` |

## Peer Dependencies

| Package | Version |
|---|---|
| `pino-pretty` | `>=10.0.0` |

## Related Packages

- `afenda-eslint-config`
- `afenda-typescript-config`

## Contributing

### Development Workflow

1. Make changes to source files
2. Run `pnpm lint:fix` to fix linting issues
3. Run `pnpm type-check` to verify types
4. Run `pnpm test` to verify tests pass
5. Run `pnpm build` to verify build succeeds

### Code Quality

- All code must pass ESLint checks
- All code must pass TypeScript type checking
- All tests must pass
- Maintain or improve test coverage

<!-- AUTOGEN:END -->

# afenda-logger

**Layer 1: Foundation** ‚Ä¢ **Role:** Structured Logging

Pino-based structured logging with context propagation for AFENDA-NEXUS.

---

## üìê Architecture Role

**Layer 1** in the 4-layer architecture:

```
Layer 3: Application (crud, observability)
Layer 2: Domain Services (workflow, 116 business-domain packages)
Layer 1: Foundation (canon, database, logger ‚Üê YOU ARE HERE, ui)
Layer 0: Configuration (eslint-config, typescript-config)
```

**Purpose:**
- Provides structured logging via Pino
- Propagates context (orgId, userId, requestId)
- Supports log levels (trace, debug, info, warn, error, fatal)

**Zero Business Logic:** This package contains ONLY logging utilities.

---

## ‚úÖ What This Package Does

### 1. Structured Logging

```typescript
import { logger } from 'afenda-logger';

logger.info('User logged in', { userId: '123', orgId: 'org-1' });
logger.error({ err: error }, 'Failed to process payment');
logger.debug({ data: { orderId: '456' } }, 'Processing order');
```

### 2. Child Loggers with Context

```typescript
import { logger } from 'afenda-logger';

const childLogger = logger.child({ orgId: 'org-1', userId: '123' });

childLogger.info('Invoice created'); // Includes orgId + userId
childLogger.warn('Credit limit exceeded');
```

### 3. Request-Scoped Logging

```typescript
import { createRequestLogger } from 'afenda-logger';

export async function handler(req: Request) {
  const requestLogger = createRequestLogger({
    requestId: req.headers.get('x-request-id'),
    orgId: req.headers.get('x-org-id'),
  });

  requestLogger.info('Request started');
  // All logs include requestId + orgId
  requestLogger.info('Request completed');
}
```

---

## ‚ùå What This Package NEVER Does

| ‚ùå Never Do This | ‚úÖ Do This Instead |
|-----------------|-------------------|
| Implement business logic | Only log events |
| Import from business-domain packages | Domains import logger |
| Import from crud | CRUD imports logger |
| Store logs in database | Use external log aggregators |
| Modify data being logged | Log read-only snapshots |

---

## üì¶ What This Package Exports

### Logger Instances

- `logger` ‚Äî Default logger instance
- `createLogger(options)` ‚Äî Create custom logger
- `createRequestLogger(context)` ‚Äî Request-scoped logger

### Log Levels

- `logger.trace(obj, msg)` ‚Äî Detailed debug info
- `logger.debug(obj, msg)` ‚Äî Debug info
- `logger.info(obj, msg)` ‚Äî Informational messages
- `logger.warn(obj, msg)` ‚Äî Warnings
- `logger.error(obj, msg)` ‚Äî Errors
- `logger.fatal(obj, msg)` ‚Äî Fatal errors (process.exit)

### Helpers

- `redactSensitive(obj)` ‚Äî Redact sensitive fields (passwords, tokens)
- `formatError(error)` ‚Äî Format Error objects for logging

---

## üìñ Usage Examples

### Basic Logging

```typescript
import { logger } from 'afenda-logger';

logger.info('Application started');
logger.info({ port: 3000 }, 'Server listening');
logger.error({ err: new Error('Connection failed') }, 'Database error');
```

### Domain Service Logging

```typescript
// business-domain/accounting/src/services/tax-calculation.ts
import { logger } from 'afenda-logger';
import type { TaxRate } from 'afenda-canon';

export function calculateTax(amountMinor: number, rate: number): number {
  logger.debug({ amountMinor, rate }, 'Calculating tax');
  
  const taxMinor = Math.round(amountMinor * rate);
  
  logger.info({ amountMinor, rate, taxMinor }, 'Tax calculated');
  return taxMinor;
}
```

### Error Logging

```typescript
import { logger } from 'afenda-logger';

try {
  await processPayment(paymentId);
} catch (error) {
  logger.error(
    { err: error, paymentId },
    'Payment processing failed'
  );
  throw error;
}
```

---

## üîó Dependencies

### Workspace Dependencies

**NONE** ‚Äî Logger has zero workspace dependencies.

### External Dependencies

- `pino` ‚Äî Fast JSON logger
- `pino-abstract-transport` ‚Äî Transport abstraction
- `pino-pretty` (peer) ‚Äî Pretty-print for development

### Who Depends on This Package

- ‚úÖ `afenda-crud` (Layer 3) ‚Äî logs mutations
- ‚úÖ `afenda-workflow` (Layer 2) ‚Äî logs rule evaluation
- ‚úÖ All 116 business-domain packages (Layer 2) ‚Äî log business events

---

## üö¶ Dependency Rules

```
‚úÖ ALLOWED:
  - External npm (pino, pino-abstract-transport)
  - Node.js built-ins

‚ùå FORBIDDEN:
  - afenda-canon (Layer 1, same layer - avoid circular deps)
  - afenda-database (Layer 1, same layer)
  - business-domain/* (Layer 2, upper layer)
  - afenda-crud (Layer 3, upper layer)
```

**Rule:** Layer 1 packages can ONLY depend on Layer 0 + external npm.

---

## üìú Scripts

```bash
pnpm build       # Build package
pnpm dev         # Watch mode
pnpm type-check  # TypeScript check
pnpm lint        # ESLint
pnpm lint:fix    # ESLint with auto-fix
```

---

## ‚ö†Ô∏è PREVENT DRIFT - Critical Architecture Rules

### üîí Rule 1: NEVER Import from Upper Layers

**‚ùå WRONG:**

```typescript
// src/index.ts
import { mutate } from 'afenda-crud'; // FORBIDDEN!
```

**Why:** Logger is Layer 1, crud is Layer 3. Dependencies flow bottom-up only.

---

### üîí Rule 2: NEVER Log Sensitive Data

**‚ùå WRONG:**

```typescript
logger.info({ password: 'secret123', token: 'abc...' }, 'User authenticated');
```

**Why:** Logs may be stored insecurely or exposed.

**‚úÖ CORRECT:**

```typescript
import { redactSensitive } from 'afenda-logger';

const safeData = redactSensitive({ password: 'secret123', email: 'user@example.com' });
logger.info(safeData, 'User authenticated');
// Logs: { password: '[REDACTED]', email: 'user@example.com' }
```

---

### üîí Rule 3: Use Structured Logging (JSON)

**‚ùå WRONG:**

```typescript
logger.info('User logged in with ID: ' + userId + ' in org: ' + orgId);
```

**Why:** String concatenation is not searchable or parseable.

**‚úÖ CORRECT:**

```typescript
logger.info({ userId, orgId }, 'User logged in');
```

---

### üîí Rule 4: Use Child Loggers for Context

**‚ùå WRONG:**

```typescript
logger.info({ orgId: 'org-1', userId: '123' }, 'Event 1');
logger.info({ orgId: 'org-1', userId: '123' }, 'Event 2');
logger.info({ orgId: 'org-1', userId: '123' }, 'Event 3');
```

**Why:** Repeating context is verbose and error-prone.

**‚úÖ CORRECT:**

```typescript
const reqLogger = logger.child({ orgId: 'org-1', userId: '123' });
reqLogger.info('Event 1');
reqLogger.info('Event 2');
reqLogger.info('Event 3');
```

---

### üîí Rule 5: NEVER Use console.log

**‚ùå WRONG:**

```typescript
console.log('Processing invoice:', invoiceId);
```

**Why:** console.log is unstructured, unsearchable, and not production-ready.

**‚úÖ CORRECT:**

```typescript
import { logger } from 'afenda-logger';

logger.info({ invoiceId }, 'Processing invoice');
```

---

### üö® Validation Commands

```bash
# Type-check
pnpm type-check

# Lint (check for console.log usage)
pnpm lint:ci

# Build
pnpm build
```

---

## üîç Quick Reference

| Question | Answer |
|----------|--------|
| **What layer?** | Layer 1 (Foundation) |
| **What does it export?** | Logger instances, log levels, helpers |
| **What does it import?** | Only pino (external npm) |
| **Who imports it?** | All packages that need logging |
| **Can it import from domains?** | ‚ùå NO (upper layer) |
| **Can it import from crud?** | ‚ùå NO (upper layer) |
| **Can it log sensitive data?** | ‚ùå NO (use redactSensitive) |
| **Should I use console.log?** | ‚ùå NO (use logger) |

---

## üìö Related Documentation

- [ARCHITECTURE.md](../../ARCHITECTURE.md) - Complete 4-layer architecture
- [packages/canon/README.md](../canon/README.md) - Type definitions
- [Pino Docs](https://getpino.io/) - Official Pino documentation

---

**Last Updated:** February 18, 2026  
**Architecture Version:** 2.0 (Clean State)
