<!-- AUTOGEN:START -->
<!-- Generated by afenda readme gen ‚Äî DO NOT EDIT inside this block -->
<!-- Signature: sha256:f2833192e58e92fde5ffa55106fe17f441166448fc61376a203929f1374372ff -->
# afenda-monorepo
## Structure

```
afenda-monorepo/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ web/
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ canon/
‚îÇ   ‚îú‚îÄ‚îÄ crud/
‚îÇ   ‚îú‚îÄ‚îÄ crud-convenience/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ eslint-config/
‚îÇ   ‚îú‚îÄ‚îÄ logger/
‚îÇ   ‚îú‚îÄ‚îÄ migration/
‚îÇ   ‚îú‚îÄ‚îÄ observability/  # OpenTelemetry instrumentation, metrics, and observability utilities for afenda
‚îÇ   ‚îú‚îÄ‚îÄ search/
‚îÇ   ‚îú‚îÄ‚îÄ typescript-config/
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îî‚îÄ‚îÄ workflow/
‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îú‚îÄ‚îÄ afenda-cli/
‚îÇ   ‚îú‚îÄ‚îÄ ci-gates/
‚îÇ   ‚îî‚îÄ‚îÄ quality-metrics/
‚îú‚îÄ‚îÄ turbo.json
‚îú‚îÄ‚îÄ pnpm-workspace.yaml
‚îî‚îÄ‚îÄ package.json
```

## Packages

| Package | Path | Type | Description |
|---|---|---|---|
| `web` | `apps/web` | app |  |
| `afenda-canon` | `packages/canon` | library |  |
| `afenda-crud` | `packages/crud` | library |  |
| `afenda-crud-convenience` | `packages/crud-convenience` | library |  |
| `afenda-database` | `packages/database` | library |  |
| `afenda-eslint-config` | `packages/eslint-config` | config |  |
| `afenda-logger` | `packages/logger` | library |  |
| `afenda-migration` | `packages/migration` | library |  |
| `afenda-observability` | `packages/observability` | library | OpenTelemetry instrumentation, metrics, and observability utilities for afenda |
| `afenda-search` | `packages/search` | library |  |
| `afenda-typescript-config` | `packages/typescript-config` | config |  |
| `afenda-ui` | `packages/ui` | ui |  |
| `afenda-workflow` | `packages/workflow` | library |  |
| `@afenda/cli` | `tools/afenda-cli` | tool |  |
| `ci-gates` | `tools/ci-gates` | tool |  |
| `quality-metrics` | `tools/quality-metrics` | tool |  |

## Scripts

| Script | Command |
|---|---|
| `pnpm adapter:build` | `pnpm afenda meta emit-all` |
| `pnpm afenda` | `node tools/afenda-cli/dist/index.js` |
| `pnpm afenda:dev` | `tsx tools/afenda-cli/src/cli.ts` |
| `pnpm afenda:discover` | `node tools/afenda-cli/dist/discover.js` |
| `pnpm audit` | `pnpm audit --audit-level=moderate` |
| `pnpm audit:fix` | `pnpm audit --fix` |
| `pnpm audit:prod` | `pnpm audit --prod --audit-level=moderate` |
| `pnpm build` | `turbo run build --concurrency=75%` |
| `pnpm build:analyze` | `ANALYZE=true turbo run build` |
| `pnpm bundle` | `pnpm afenda bundle` |
| `pnpm bundle:dry` | `pnpm afenda bundle --dry-run` |
| `pnpm canon:check-deps` | `bash scripts/check-canon-deps.sh` |
| `pnpm canon:check-imports` | `depcruise packages/canon/src --config .dependency-cruiser.cjs` |
| `pnpm canon:test` | `pnpm --filter afenda-canon test` |
| `pnpm canon:test:coverage` | `pnpm --filter afenda-canon test:coverage` |
| `pnpm changelog:generate` | `tsx tools/scripts/generate-changelog.ts` |
| `pnpm changelog:update` | `tsx tools/scripts/generate-changelog.ts -- --update` |
| `pnpm ci:adapter-gates` | `node -e "process.exit(0)"` |
| `pnpm ci:ais-benchmark` | `node tools/ci-ais-benchmark-gate.mjs` |
| `pnpm ci:check` | `pnpm afenda housekeeping` |
| `pnpm ci:domain-gates` | `node tools/ci-domain-gates.mjs` |
| `pnpm ci:finance-audit` | `node tools/ci-finance-audit-gate.mjs` |
| `pnpm ci:finance-audit:emit` | `node tools/ci-finance-audit-gate.mjs --emit-only` |
| `pnpm ci:housekeeping` | `pnpm bundle` |
| `pnpm ci:invariants` | `pnpm afenda housekeeping` |
| `pnpm clean` | `turbo run clean && rimraf node_modules/.cache` |
| `pnpm clean:all` | `pnpm clean && rimraf .turbo && rimraf **/node_modules` |
| `pnpm dev` | `turbo run dev --no-cache --continue` |
| `pnpm dev:turbo` | `turbo run dev --ui=tui` |
| `pnpm engine:generate` | `pnpm --filter afenda-ui engine:generate` |
| `pnpm finance:docs` | `node tools/finance-audit-docs.mjs` |
| `pnpm finance:evidence-pack` | `node tools/finance-evidence-pack.mjs` |
| `pnpm format` | `prettier --write "**/*.{ts,tsx,css,md,json,yaml,yml}" --cache` |
| `pnpm format:check` | `prettier --check "**/*.{ts,tsx,css,md,json,yaml,yml}" --cache` |
| `pnpm housekeeping` | `pnpm afenda housekeeping` |
| `pnpm housekeeping:fix` | `pnpm afenda housekeeping --fix` |
| `pnpm lint` | `turbo run lint --continue` |
| `pnpm lint:ci` | `turbo run lint:ci --continue --concurrency=100%` |
| `pnpm lint:fix` | `turbo run lint:fix --continue` |
| `pnpm meta:check` | `pnpm afenda meta check` |
| `pnpm meta:gen` | `pnpm afenda meta gen` |
| `pnpm meta:matrix` | `pnpm afenda meta matrix` |
| `pnpm migrate:catalog` | `tsx tools/scripts/migrate-to-catalog.ts` |
| `pnpm postinstall` | `node -e "try{require('./tools/afenda-cli/dist/discover.js')}catch(e){process.exit(0)}"` |
| `pnpm project:check` | `pnpm afenda project check` |
| `pnpm project:gen` | `pnpm afenda project gen` |
| `pnpm project:gen:dry` | `pnpm afenda project gen --dry-run` |
| `pnpm proposal:check` | `pnpm afenda proposal check` |
| `pnpm proposal:gen` | `pnpm afenda proposal gen` |
| `pnpm proposal:gen:dry` | `pnpm afenda proposal gen --dry-run` |
| `pnpm quality:analyze` | `pnpm --filter quality-metrics analyze` |
| `pnpm quality:badges` | `tsx tools/scripts/generate-badges.ts` |
| `pnpm quality:badges:update` | `tsx tools/scripts/generate-badges.ts --update` |
| `pnpm quality:churn` | `tsx tools/scripts/analyze-churn.ts` |
| `pnpm quality:collect` | `pnpm --filter quality-metrics collect` |
| `pnpm quality:complexity` | `tsx tools/scripts/analyze-complexity.ts` |
| `pnpm quality:flakiness` | `pnpm --filter quality-metrics flakiness` |
| `pnpm quality:full` | `pnpm quality:collect && pnpm quality:analyze && pnpm quality:flakiness && pnpm quality:performance && pnpm quality:insights` |
| `pnpm quality:gates` | `pnpm --filter quality-metrics gates` |
| `pnpm quality:insights` | `pnpm --filter quality-metrics insights` |
| `pnpm quality:notify` | `tsx tools/scripts/notify-team.ts` |
| `pnpm quality:performance` | `pnpm --filter quality-metrics performance` |
| `pnpm quality:plugins` | `tsx tools/scripts/run-plugins.ts` |
| `pnpm quality:pr-comment` | `tsx tools/scripts/generate-pr-comment.ts` |
| `pnpm quality:report` | `pnpm --filter quality-metrics report` |
| `pnpm quality:security` | `pnpm --filter quality-metrics security` |
| `pnpm readme:check` | `pnpm afenda readme check` |
| `pnpm readme:gen` | `pnpm afenda readme gen` |
| `pnpm readme:sync` | `pnpm afenda readme sync` |
| `pnpm sbom` | `pnpm dlx @cyclonedx/cdxgen -r --no-install-deps -o sbom.json` |
| `pnpm search:bootstrap` | `pnpm --filter web search:bootstrap` |
| `pnpm test` | `vitest run` |
| `pnpm test:coverage` | `vitest run --coverage` |
| `pnpm test:coverage:ui` | `vitest --ui --coverage` |
| `pnpm test:db-contracts` | `vitest run -c business-domain/finance/vitest.integration.config.ts` |
| `pnpm test:domain` | `pnpm --filter afenda-accounting --filter afenda-tax-engine --filter afenda-fx-management --filter afenda-receivables --filter afenda-payables --filter afenda-bank-reconciliation --filter afenda-consolidation --filter afenda-intercompany --filter afenda-treasury --filter afenda-fixed-assets --filter afenda-revenue-recognition --filter afenda-cost-accounting --filter afenda-budgeting --filter afenda-credit-management --filter afenda-expense-management --filter afenda-subscription-billing --filter afenda-project-accounting --filter afenda-lease-accounting test` |
| `pnpm test:e2e` | `playwright test --project=chromium` |
| `pnpm test:e2e:all` | `playwright test` |
| `pnpm test:e2e:codegen` | `playwright codegen http://localhost:3000` |
| `pnpm test:e2e:debug` | `playwright test --debug` |
| `pnpm test:e2e:install` | `playwright install --with-deps` |
| `pnpm test:e2e:report` | `playwright show-report` |
| `pnpm test:e2e:ui` | `playwright test --ui` |
| `pnpm test:ui` | `vitest --ui` |
| `pnpm test:watch` | `vitest watch` |
| `pnpm type-check` | `turbo run type-check --continue --concurrency=100%` |
| `pnpm type-check:all` | `pnpm type-check && pnpm type-check:refs` |
| `pnpm type-check:refs` | `tsc -b` |
| `pnpm type-check:refs:clean` | `tsc -b --clean && tsc -b` |
| `pnpm type-check:strict` | `turbo run type-check -- --strict` |
| `pnpm ui:add` | `pnpm dlx shadcn@latest add -c apps/web` |
| `pnpm ui:diff` | `pnpm dlx shadcn@latest diff -c apps/web` |
| `pnpm ui:update` | `pnpm dlx shadcn@latest add -o -c apps/web` |
| `pnpm validate:catalog` | `tsx tools/scripts/validate-catalog.ts` |
| `pnpm validate:deps` | `tsx tools/scripts/validate-deps.ts` |

<!-- AUTOGEN:END -->

A modern monorepo powered by Turborepo, Next.js 16 with Turbopack, and
TypeScript.

## Getting Started

1. Install dependencies:

   ```bash
   pnpm install
   ```

2. Start the development server:

   ```bash
   pnpm dev
   ```

3. Open [http://localhost:3000](http://localhost:3000) to view the application.

## üéØ Important: Configuration & Best Practices

This monorepo follows strict configuration standards for consistency across **64 packages** (10 core packages, 48 business domains, 2 tools, 1 app).

### üìñ Core Documentation

**Start here when working with packages:**

- **[PACKAGE_TEMPLATE.md](packages/PACKAGE_TEMPLATE.md)** - Template for new packages with configuration examples
- **[CONFIGURATION_GUIDE.md](docs/CONFIGURATION_GUIDE.md)** - Complete guide to TypeScript, package.json, and build configs
- **[CONFIG-QUICK-REF.md](docs/CONFIG-QUICK-REF.md)** - Fast lookup for common patterns
- **[GOVERNANCE.md](packages/GOVERNANCE.md)** - Layer restrictions and dependency rules

### ‚öôÔ∏è Configuration Standards

**TypeScript:**

- All packages extend shared presets from `packages/typescript-config/`
- Use `base.json` for standard packages, `react-library.json` for React components, `nextjs.json` for Next.js apps
- Minimize package-specific overrides

**Dependencies:**

- Internal packages: `workspace:*` protocol
- Common external packages: `catalog:` (managed in root)
- Follow [GOVERNANCE.md](packages/GOVERNANCE.md) layer restrictions

**Scripts:**

- Use standardized naming: `type-check`, `lint`, `lint:ci`, `lint:fix`
- All packages must have: `type-check` and `lint`
- Optional: `build`, `dev`, `test`

### ‚úÖ Before Committing

```bash
pnpm type-check    # TypeScript validation
pnpm lint          # Code quality
pnpm lint:ci       # Check for circular dependencies
pnpm build         # Verify builds work
```

### üöÄ Recent Updates

- ‚úÖ Synchronized all 64 TypeScript configurations (see [CONFIG-SYNC-REPORT.md](docs/CONFIG-SYNC-REPORT.md))
- ‚úÖ Next.js 16 optimizations with `verbatimModuleSyntax`
- ‚úÖ Turborepo caching enhancements
- ‚úÖ pnpm workspace optimizations (.npmrc)

## Development Workflow

1. Make changes to packages or apps
2. Turborepo automatically handles dependencies and caching
3. Use `pnpm build` to verify changes
4. Use `pnpm lint` and `pnpm type-check` to ensure code quality

**Lint & type debugging:** Cursor skill at `.cursor/skills/lint-types-debug/` ‚Äî
use when lint or type-check fails, or when debugging INVARIANT/EX-LINT issues.

## Adding New Packages

Follow the comprehensive guide in [CONFIGURATION_GUIDE.md](docs/CONFIGURATION_GUIDE.md#adding-a-new-package) or use this quick checklist:

1. **Create package directory:**

   ```bash
   mkdir packages/my-new-package
   cd packages/my-new-package
   ```

2. **Create `package.json`** (see [PACKAGE_TEMPLATE.md](packages/PACKAGE_TEMPLATE.md) for full template):

   ```json
   {
     "name": "afenda-my-new-package",
     "version": "0.1.0",
     "private": true,
     "type": "module",
     "main": "./src/index.ts",
     "scripts": {
       "type-check": "tsc --noEmit",
       "lint": "eslint . --ext .ts,.tsx --cache"
     },
     "devDependencies": {
       "afenda-typescript-config": "workspace:*",
       "afenda-eslint-config": "workspace:^"
     }
   }
   ```

3. **Create `tsconfig.json`:**

   ```json
   {
     "extends": "afenda-typescript-config/base.json",
     "compilerOptions": {
       "tsBuildInfoFile": "./dist/.tsbuildinfo"
     },
     "include": ["src/**/*"],
     "exclude": ["node_modules", "dist"]
   }
   ```

4. **Create `src/index.ts`** with exports

5. **Validate:**

   ```bash
   pnpm install
   pnpm type-check
   pnpm lint
   ```

6. **Generate README:**
   ```bash
   pnpm afenda readme gen
   ```

**See also:** [CONFIG-QUICK-REF.md](docs/CONFIG-QUICK-REF.md) for copy-paste ready patterns

## Deployment

The monorepo is configured for optimal deployment with Vercel. Each app can be
deployed independently.

## üîß Troubleshooting

### Common Issues

**"Cannot find module 'afenda-typescript-config'"**

```bash
pnpm install  # Re-link workspace dependencies
```

**Circular dependency warnings**

```bash
pnpm lint:ci  # Check which packages have cycles
# See GOVERNANCE.md for layer restrictions
```

**Stale build cache**

```bash
turbo run build --force  # Force rebuild without cache
rm -rf .turbo && pnpm build  # Clear cache completely
```

**TypeScript incremental build issues**

```bash
pnpm -r exec -- rm -rf dist/.tsbuildinfo
pnpm build
```

**ESLint cache issues**

```bash
pnpm -r exec -- rm -rf .eslintcache
pnpm lint
```

**Slow type-check or lint (memory-constrained)**

On large monorepos or CI, type-heavy workloads may benefit from:

```bash
NODE_OPTIONS=--max-semi-space-size=256 pnpm type-check
NODE_OPTIONS=--max-semi-space-size=256 pnpm lint:ci
```

**For more troubleshooting:** See [CONFIGURATION_GUIDE.md](docs/CONFIGURATION_GUIDE.md#troubleshooting)

## Learn More

### Monorepo Documentation

- **[CONFIGURATION_GUIDE.md](docs/CONFIGURATION_GUIDE.md)** - Complete configuration management guide
- **[CONFIG-QUICK-REF.md](docs/CONFIG-QUICK-REF.md)** - Quick reference for common patterns
- **[CONFIG-SYNC-REPORT.md](docs/CONFIG-SYNC-REPORT.md)** - Configuration synchronization details
- **[PACKAGE_TEMPLATE.md](packages/PACKAGE_TEMPLATE.md)** - Template for new packages
- **[GOVERNANCE.md](packages/GOVERNANCE.md)** - Layer restrictions and dependency rules
- **[ARCHITECTURE.md](ARCHITECTURE.md)** - System architecture overview
- **[CODING_STANDARDS.md](docs/CODING_STANDARDS.md)** - Code conventions

### Installed Skills

Located in `.agents/skills/`:

- **monorepo-management** - Turborepo, Nx, pnpm workspace patterns
- **pnpm** - Workspace protocol, catalogs, CLI commands
- **next-best-practices** - Next.js conventions and patterns
- **nextjs-16-complete-guide** - Next.js 16 features and migration
- **optimized-nextjs-typescript** - Next.js TypeScript optimization

### External Resources

- [Turborepo Documentation](https://turbo.build/repo/docs)
- [Next.js Documentation](https://nextjs.org/docs)
- [PNPM Workspace Documentation](https://pnpm.io/workspaces)
- [TypeScript Project References](https://www.typescriptlang.org/docs/handbook/project-references.html)
